---
title: "Example - Segment integration"
description: "In this example we'll demonstrate a webhook integration with Segment"
---

![](/images/7a5f921-image_1.png) 

<Note> 
Segment expects events to be reported for a specific user. Consequently, this integration only supports events from Stigg that are reported on **customers**.
</Note>

  
## Adding a source function in Segment

Segment expects events to be reported on a specific user. In order to support this flow, we'll need to map Stigg's webhook payload to a `Segment.track()`event using a [Segment's source function](https://segment.com/docs/connections/functions/source-functions/).

In Segment:

1. From your workspace, go to the Catalog and click the [Functions tab](https://app.segment.com/goto-my-workspace/functions/catalog).
2. Click "New Function".
3. Select "Source Function" and click "Build" - when you click "Build", a code editor appears.
4. Paste the below snippet.
5. Click "Configure" to name the source function.
6. Click "Create Function" to save it - once you do that, the source function appears on the Functions page in your workspace’s catalog.

```javascript JavaScript
// Learn more about source functions API at
// https://segment.com/docs/connections/sources/source-functions

/**
 * Handle incoming HTTP request
 *
 * @param  {FunctionRequest} request
 * @param  {FunctionSettings} settings
 */
async function onRequest(request, settings) {
    const body = request.json();

    // filter out events that are not reported on a customer
    if (!body.customer || !body.customer.id) {
        return;
    }

    // See https://segment.com/docs/connections/spec/track/
    Segment.track({
        event: body.type.split('.').join('_'),
        userId: body.customer.id,
        properties: body
    });
}
```

  
## Connecting the source function to a source in Segment

In Segment:

<Note>
You must be a **Workspace Owner** or **Source Admin** to connect an instance of your function in your workspace.
</Note>

1. From the [Functions tab](https://app.segment.com/goto-my-workspace/functions/catalog), click "Connect Source" and follow the prompts to set it up in your workspace.
2. Once configured, find the webhook URL - either on the "Overview" or "Settings → Endpoint" page.
3. Copy the URL.
  
## Creating the webhook in Stigg

In Stigg:

1. Navigate to the Settings > Integrations > Webhooks screen.
2. Click on the "+ New webhook" button.
3. In the opened modal enter the following details:  
   1. Service name - the name of the service that's integrated with Stigg, for example: "Segment".  
   2. Endpoint URL - the URL that was generated by Segment.  
   3. Events to send - select the list of events that you'd like to send to this endpoint.

<Note> 
It's recommended to only send events that relate to customers. The full list of events can be found [here](https://stigg.readme.io/docs/events).
</Note>

Click "Add" to confirm the action.

  
## Sending data to the webhook

In Stigg:

1. Click on the row of the newly created webhook from the webhook list screen in order to view the webhook details.
2. Under the "Webhook events" section, click on the dotted menu icon of the relevant event that you'd like to test, and select the "Send test event" action.
3. Click on "Send test event" to confirm the action.
  
## Validating the integration

In Segment:

1. From the [Sources](https://app.segment.com/goto-my-workspace/sources/) tab select the source that was added.
2. Select the "Debugger" tab.
3. Ensure that you see the event that you sent from Stigg with the same payload.

Once the integration has been validated, you can [connect the source to destinations in Segment](https://segment.com/docs/connections/destinations/add-destination/).

  
## References

<Card 
    title="Source Functions - Segment Documentation Segment" 
    href="https://segment.com/docs/connections/functions/source-functions/"
    icon={
        <svg
      width={20}
      height={20}
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    >
      <g clipPath="url(#clip0_6_224)">
        <path
          d="M12.461 13.397H.961a.963.963 0 01-.961-.96c0-.528.432-.96.96-.96h11.501c.528 0 .96.432.96.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M10.012 19.28a9.73 9.73 0 01-2.761-.409c-.504-.168-.792-.696-.624-1.2.168-.504.696-.792 1.2-.624.696.216 1.44.336 2.185.336 3.265 0 6.098-2.089 7.035-5.21.144-.504.696-.793 1.2-.648.505.144.793.696.648 1.2-1.224 3.914-4.777 6.555-8.883 6.555z"
          fill="#49B881"
        />
        <path
          d="M19.04 8.523H7.539a.963.963 0 01-.96-.96c0-.528.432-.96.96-.96h11.5c.529 0 .961.432.961.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M2.04 8.523c-.095 0-.191-.024-.287-.048-.505-.144-.793-.696-.649-1.2C2.33 3.36 5.882.72 10.012.72a9.73 9.73 0 012.761.408c.504.169.792.697.624 1.2-.168.505-.696.793-1.2.625a7.416 7.416 0 00-2.185-.336c-3.265 0-6.098 2.089-7.035 5.21a.994.994 0 01-.936.696z"
          fill="#49B881"
        />
        <path
          d="M15.702 4.874a.96.96 0 100-1.92.96.96 0 000 1.92zM4.298 17.07a.96.96 0 100-1.92.96.96 0 000 1.92z"
          fill="#99CFAC"
        />
      </g>
      <defs>
        <clipPath id="clip0_6_224">
          <path fill="#fff" d="M0 0H20V20H0z" />
        </clipPath>
      </defs>
    </svg>
    }></Card>

<Card 
    title="Using the Source Debugger - Segment Documentation Segment" 
    href="https://segment.com/docs/connections/sources/debugger/"
    icon={
        <svg
      width={20}
      height={20}
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    >
      <g clipPath="url(#clip0_6_224)">
        <path
          d="M12.461 13.397H.961a.963.963 0 01-.961-.96c0-.528.432-.96.96-.96h11.501c.528 0 .96.432.96.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M10.012 19.28a9.73 9.73 0 01-2.761-.409c-.504-.168-.792-.696-.624-1.2.168-.504.696-.792 1.2-.624.696.216 1.44.336 2.185.336 3.265 0 6.098-2.089 7.035-5.21.144-.504.696-.793 1.2-.648.505.144.793.696.648 1.2-1.224 3.914-4.777 6.555-8.883 6.555z"
          fill="#49B881"
        />
        <path
          d="M19.04 8.523H7.539a.963.963 0 01-.96-.96c0-.528.432-.96.96-.96h11.5c.529 0 .961.432.961.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M2.04 8.523c-.095 0-.191-.024-.287-.048-.505-.144-.793-.696-.649-1.2C2.33 3.36 5.882.72 10.012.72a9.73 9.73 0 012.761.408c.504.169.792.697.624 1.2-.168.505-.696.793-1.2.625a7.416 7.416 0 00-2.185-.336c-3.265 0-6.098 2.089-7.035 5.21a.994.994 0 01-.936.696z"
          fill="#49B881"
        />
        <path
          d="M15.702 4.874a.96.96 0 100-1.92.96.96 0 000 1.92zM4.298 17.07a.96.96 0 100-1.92.96.96 0 000 1.92z"
          fill="#99CFAC"
        />
      </g>
      <defs>
        <clipPath id="clip0_6_224">
          <path fill="#fff" d="M0 0H20V20H0z" />
        </clipPath>
      </defs>
    </svg>
    }></Card>
  
<Card 
    title="Sending Segment Data to Destinations - Segment Documentation Segment" 
    href="https://segment.com/docs/connections/destinations/add-destination/"
    icon={
        <svg
      width={20}
      height={20}
      viewBox="0 0 20 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    >
      <g clipPath="url(#clip0_6_224)">
        <path
          d="M12.461 13.397H.961a.963.963 0 01-.961-.96c0-.528.432-.96.96-.96h11.501c.528 0 .96.432.96.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M10.012 19.28a9.73 9.73 0 01-2.761-.409c-.504-.168-.792-.696-.624-1.2.168-.504.696-.792 1.2-.624.696.216 1.44.336 2.185.336 3.265 0 6.098-2.089 7.035-5.21.144-.504.696-.793 1.2-.648.505.144.793.696.648 1.2-1.224 3.914-4.777 6.555-8.883 6.555z"
          fill="#49B881"
        />
        <path
          d="M19.04 8.523H7.539a.963.963 0 01-.96-.96c0-.528.432-.96.96-.96h11.5c.529 0 .961.432.961.96s-.432.96-.96.96z"
          fill="#99CFAC"
        />
        <path
          d="M2.04 8.523c-.095 0-.191-.024-.287-.048-.505-.144-.793-.696-.649-1.2C2.33 3.36 5.882.72 10.012.72a9.73 9.73 0 012.761.408c.504.169.792.697.624 1.2-.168.505-.696.793-1.2.625a7.416 7.416 0 00-2.185-.336c-3.265 0-6.098 2.089-7.035 5.21a.994.994 0 01-.936.696z"
          fill="#49B881"
        />
        <path
          d="M15.702 4.874a.96.96 0 100-1.92.96.96 0 000 1.92zM4.298 17.07a.96.96 0 100-1.92.96.96 0 000 1.92z"
          fill="#99CFAC"
        />
      </g>
      <defs>
        <clipPath id="clip0_6_224">
          <path fill="#fff" d="M0 0H20V20H0z" />
        </clipPath>
      </defs>
    </svg>
    }></Card>
  